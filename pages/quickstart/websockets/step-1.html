---
layout: quickstart
permalink: /quickstart/websockets/step-1/
---

{% capture markdown %}

# Step 1: Add WebSocket Support

In this step we'll update our application to include support for WebSockets, so we can automatically display changes
made by users without having to refresh the page.

> You can view the finished code for this step by checking out the `websockets.1` branch of the [completed project](/quickstart/misc/completed-project/).


### Add the WebSockets Hook
First install the `lore-hook-websockets-sails` hook:

```
npm install lore-hook-websockets-sails --save
```

Next register the hook in your `index.js` file:

```js
lore.summon({
  hooks: {
    // ...
    router: require('lore-hook-router'),
    websockets: require('lore-hook-websockets-sails')
  }
});
```

### Add the WebSockets Config File
Next add the config file that controls the hook:

```js
// config/websockets.js
module.exports = {
  serverUrl: 'http://localhost:1337'
};
```

While the hook exposes many more config options, the only one we need for this example is the location of the
socket.io server, which runs on the same port as the Sails API.


### Subscribe to Data
Next, initialize the hook by subscribing to data for `tweets` in the `Master` component when the application mounts,
and unsubscribe to the data when the application unmounts:

```jsx
componentDidMount: function() {
  lore.websockets.tweet.connect();
  lore.websockets.tweet.subscribe();
},

componentWillUnmount: function() {
  lore.websockets.tweet.unsubscribe();
},
```

That's it! With that change in place, the application will start listening for new data when it mounts, and tweets
created by other users will immediately show up at the top of the feed, just like tweets you create yourself.


### Visual Check-in

If everything went well, your application should now look like this (exactly the same).

<img class="drop-shadow" src="/assets/images/quickstart/filtering/step-1.png">


## Code Changes

Below is a list of files modified during this step.

### index.js

{% tabs tab1={"name": "ES5", "id": 1} | tab3={"name": "ES6", "id": 2} | tab4={"name": "ESNext", "id": 3} %}
{% tab id=1, is_active=true %}
```jsx
var lore = require('lore');
var _ = require('lodash');

// Allows you to access your lore app globally as well as from within
// the console. Remove this line if you don't want to be able to do that.
window.lore = lore;

// Summon the app!
lore.summon({
  hooks: {
    auth: require('lore-hook-auth'),
    actions: require('lore-hook-actions'),
    bindActions: require('lore-hook-bind-actions'),
    collections: require('lore-hook-collections'),
    connections: require('lore-hook-connections'),
    connect: require('/Users/jchansen/lore/lore/packages/lore-hook-connect/src'),
    dialog: require('lore-hook-dialog'),
    dialogs: require('lore-hook-dialogs-bootstrap'),
    models: require('lore-hook-models'),
    react: require('lore-hook-react'),
    reducers: require('lore-hook-reducers'),
    redux: _.extend(require('lore-hook-redux'), {
      dependencies: ['reducers', 'auth']
    }),
    router: require('lore-hook-router'),
    websockets: require('lore-hook-websockets-sails')
  }
});
```
{% endtab %}
{% tab id=2 %}
```jsx
// PASTE_HERE
```
{% endtab %}
{% tab id=3 %}
```jsx
// PASTE_HERE
```
{% endtab %}
{% endtabs %}

### config/websockets.js

{% tabs tab1={"name": "ES5", "id": 4} | tab2={"name": "ES6", "id": 5} | tab3={"name": "ESNext", "id": 6} %}
{% tab id=4, is_active=true %}
```jsx
module.exports = {
  serverUrl: 'http://localhost:1337'
};
```
{% endtab %}
{% tab id=5 %}
```jsx
// PASTE_HERE
```
{% endtab %}
{% tab id=6 %}
```jsx
// PASTE_HERE
```
{% endtab %}
{% endtabs %}

### src/components/Master.js

{% tabs tab1={"name": "ES5", "id": 7} | tab2={"name": "ES6", "id": 8} | tab3={"name": "ESNext", "id": 9} %}
{% tab id=7, is_active=true %}
```jsx
var React = require('react');
var PayloadStates = require('../constants/PayloadStates');
require('../../assets/css/main.css');

module.exports = lore.connect(function(getState, props) {
  return {
    user: getState('currentUser')
  };
}, { subscribe: true })(
  React.createClass({
    displayName: 'Master',

    propTypes: {
      user: React.PropTypes.object.isRequired
    },

    childContextTypes: {
      user: React.PropTypes.object
    },

    getChildContext: function() {
      return {
        user: this.props.user
      };
    },

    componentDidMount: function() {
      // If you want to play with the router through the browser's dev console then
      // uncomment out this line. React Router automatically provides 'router'
      // to any components that are "routes" (such as Master and Layout), so this
      // is a good location to attach it to the global lore object.

      // lore.router = this.props.router;

      lore.websockets.tweet.connect();
      lore.websockets.tweet.subscribe();
    },

    componentWillUnmount: function() {
      lore.websockets.tweet.unsubscribe();
    },

    render: function() {
      var user = this.props.user;

      if (user.state === PayloadStates.FETCHING) {
        return (
          <h1 className="loading-text">
            Loading...
          </h1>
        )
      }

      if (user.state === PayloadStates.ERROR_FETCHING) {
        return (
          <h1 className="loading-text">
            Unauthorized
          </h1>
        )
      }

      return (
        <div>
          {React.cloneElement(this.props.children)}
        </div>
      );
    }
  })
);
```
{% endtab %}
{% tab id=8 %}
```jsx
// PASTE_HERE
```
{% endtab %}
{% tab id=9 %}
```jsx
// PASTE_HERE
```
{% endtab %}
{% endtabs %}


## Next Steps

In the next section we'll learn how to [build and deploy the application for production](../../publishing/overview/).

{% endcapture %}
{{ markdown | markdownify }}
